# **Recherche en texte intégral et filtrage dans Elasticsearch**

Ce TP vous introduit aux bases de la recherche en texte intégral avec Elasticsearch, également connue sous le nom de recherche lexicale, en utilisant l'API `_search` et le DSL de requête. Vous apprendrez également à filtrer les données pour affiner les résultats de recherche en fonction de critères précis.

Dans ce scénario, nous mettons en place une fonction de recherche pour un blog culinaire. Le blog contient des recettes avec divers attributs, y compris du contenu textuel, des données catégorielles et des évaluations numériques.

L'objectif est de créer des requêtes de recherche permettant aux utilisateurs de :

- Trouver des recettes en fonction des ingrédients qu'ils souhaitent utiliser ou éviter
- Découvrir des plats adaptés à leurs besoins alimentaires
- Trouver des recettes bien notées dans des catégories spécifiques
- Trouver des recettes récentes de leurs auteurs préférés

Pour atteindre ces objectifs, nous utiliserons différentes requêtes Elasticsearch pour effectuer des recherches en texte intégral, appliquer des filtres et combiner plusieurs critères de recherche.

## **Étape 1 : Créer un index**

Créez l'index `cooking_blog` pour commencer :

```http
PUT /cooking_blog
```

Ensuite, définissez les mappings pour l'index :

```http
PUT /cooking_blog/_mapping
{
  "properties": {
    "title": {
      "type": "text",
      "analyzer": "standard",
      "fields": {
        "keyword": {
          "type": "keyword",
          "ignore_above": 256
        }
      }
    },
    "description": {
      "type": "text",
      "fields": {
        "keyword": {
          "type": "keyword"
        }
      }
    },
    "author": {
      "type": "text",
      "fields": {
        "keyword": {
          "type": "keyword"
        }
      }
    },
    "date": {
      "type": "date",
      "format": "yyyy-MM-dd"
    },
    "category": {
      "type": "text",
      "fields": {
        "keyword": {
          "type": "keyword"
        }
      }
    },
    "tags": {
      "type": "text",
      "fields": {
        "keyword": {
          "type": "keyword"
        }
      }
    },
    "rating": {
      "type": "float"
    }
  }
}
```

Dans cette configuration :

- Les champs `title`, `description`, `author`, `category` et `tags` sont de type `text` pour permettre la recherche en texte intégral. Chacun a un sous-champ `keyword` pour les recherches exactes.
- Le champ `date` est de type `date` avec le format `yyyy-MM-dd`.
- Le champ `rating` est de type `float` pour stocker les évaluations numériques.

## **Étape 2 : Ajouter des documents**

Ajoutez des documents représentant des recettes à l'index :

```http
POST /cooking_blog/_doc/1
{
  "title": "Spaghetti Carbonara",
  "description": "A classic Italian pasta dish with eggs, cheese, pancetta, and pepper.",
  "author": "John Doe",
  "date": "2023-01-15",
  "category": "Pasta",
  "tags": ["Italian", "Quick", "Dinner"],
  "rating": 4.5
}
```

```http
POST /cooking_blog/_doc/2
{
  "title": "Vegan Tacos",
  "description": "Delicious and healthy vegan tacos with black beans and avocado.",
  "author": "Jane Smith",
  "date": "2023-02-10",
  "category": "Mexican",
  "tags": ["Vegan", "Healthy", "Lunch"],
  "rating": 4.7
}
```

Répétez ce processus pour ajouter plus de recettes avec diverses catégories, tags et évaluations.

## **Étape 3 : Effectuer une recherche en texte intégral**

Pour rechercher des recettes contenant le mot "pasta" dans le titre :

```http
GET /cooking_blog/_search
{
  "query": {
    "match": {
      "title": "pasta"
    }
  }
}
```

Cette requête renvoie les recettes dont le titre correspond au terme "pasta".

## **Étape 4 : Appliquer des filtres aux résultats de recherche**

Pour trouver des recettes végétaliennes (tag "Vegan") avec une note supérieure à 4 (greater than 4) :

```http
GET /cooking_blog/_search
{
  "query": {
    "bool": {
      "must": {
        "match": {
          "tags": "Vegan"
        }
      },
      "filter": {
        "range": {
          "rating": {
            "gt": 4
          }
        }
      }
    }
  }
}
```

Cette requête combine une recherche en texte intégral avec un filtre numérique pour affiner les résultats.

## **Étape 5 : Combiner plusieurs critères de recherche**

Pour rechercher des recettes de l'auteur "Jane Smith" publiées après le 1er janvier 2023 :

```http
GET /cooking_blog/_search
{
  "query": {
    "bool": {
      "must": {
        "match": {
          "author": "Jane Smith"
        }
      },
      "filter": {
        "range": {
          "date": {
            "gt": "2023-01-01"
          }
        }
      }
    }
  }
}
```

Cette requête renvoie les recettes de "Jane Smith" publiées après le 1er janvier 2023. 
